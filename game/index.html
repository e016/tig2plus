<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, viewport-fit=cover"
    />
    <title>The Impossible Game 2+</title>
    <link rel="stylesheet" href="fonts/font-face.css" />
    <link rel="icon" type="image/x-icon" href="favicon.ico" />
    <link rel="manifest" href="manifest.json" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="mobile-web-app-title" content="TIG2+" />
    <style>
      html,
      body {
        margin: 0;
        height: 100%;
        width: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
        -webkit-user-select: none;
        user-select: none;
        touch-action: none;
      }
      canvas {
        -webkit-user-select: none;
        user-select: none;
      }
    </style>
  </head>

  <body>
    <script type="text/javascript">
      window.Android = {};
      window.Android.bridge = function () {
        console.log("bridge!", arguments);
      };
      String.prototype.contains = function (x) {
        return !(this.indexOf(x) < 0);
      };
      if ("username" in localStorage) {
        localStorage.setItem("username", "Player");
      }
      document.addEventListener(
        "keydown",
        function (event) {
          if (
            (event.key.toLowerCase() === "d" ||
              event.key.toLowerCase() === "s" ||
              event.which === 61 ||
              event.which === 107 ||
              event.which === 173 ||
              event.which === 109 ||
              event.which === 187 ||
              event.which === 189 ||
              event.which === 48) &&
            (event.ctrlKey || event.metaKey)
          ) {
            event.preventDefault();
            event.stopPropagation();
          }
        },
        false
      );
      document.addEventListener(
        "wheel",
        function (e) {
          if (e.ctrlKey || e.metaKey) {
            e.preventDefault();
          }
        },
        { passive: false }
      );
    </script>
    <script type="text/javascript" src="./locale/localize.js"></script>
    <script type="text/javascript" src="./jokes.js"></script>
    <script type="text/javascript" src="./locale/es.js"></script>
    <script type="text/javascript" src="game.js"></script>
    <script type="text/javascript" src="renderCanvas.js"></script>
    <script type="text/javascript">
      window.onerror = (e, _, line, col) => {
        window.alert(`${e.message || e}. Line: ${line} col: ${col}`);
        console.error(
          `__crash_game__${e.message || e}. Line: ${line} col: ${col}`
        );
      };
      window.onunhandledrejection = (event) => {
        if (event.reason instanceof Error) {
          const error = event.reason;
          console.error(`__crash_game__${error}`, event);
        }
      };
      const names = [
        "Black",
        "BlackItalic",
        "ExtraBold",
        "SemiBold",
        "Medium",
        "MediumItalic",
      ];
      Promise.all(
        names.map((name) =>
          new FontFace(
            "Montserrat",
            `url("./fonts/Montserrat-${name}.ttf")`
          ).load()
        )
      ).then(() => {
        const result =
          typeof renderCanvas === "undefined"
            ? Error("Order execution")
            : renderCanvas.run();

        if (result instanceof Error) {
          alert(
            "Sorry, your device is missing features required to run the game. Try updating your device's software and browser versions and try again."
          );
        }
      });
    </script>
  </body>
</html>
